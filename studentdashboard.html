<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Student Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="container d-flex align-items-center justify-content-between my-3">
        <div class="brand d-flex align-items-center">
            <div class="logo">CN</div>
            <div class="name">Student Portal</div>
        </div>
        <a class="btn btn-primary" href="index.html">Log Out</a>
    </header>

    <main class="container">
        <div class="dashboard-container">
            <!-- NEW: top bar inside the big white box -->
            <div class="dashboard-top-bar">
                <!-- Settings icon (top-left) -->
                <button
                    type="button"
                    class="settings-icon"
                    id="settingsButton"
                    aria-label="User settings">
                    ⚙
                </button>

                <!-- Subject dropdown (top-right) -->
                <div class="subject-select">
                    <label for="subjectSelect" class="form-label mb-0 me-2">Subject:</label>
                    <select id="subjectSelect" class="form-select form-select-sm">
                        <option value="Engineering">Engineering</option>
                        <option value="Physics">Physics</option>
                        <option value="Maths">Maths</option>
                    </select>
                </div>
            </div>

            <!-- Video header row: only shown in Videos mode -->
            <div class="video-header-row" id="videoHeaderRow">
                <span class="video-header-left">Suggested video</span>
                <span class="video-header-right">Similar videos</span>
            </div>

            <div class="learning-root">
                <!-- Initial selection square -->
                <div class="learning-selection" id="learningSelection">
                    <div class="selection-card">
                        <h2 class="selection-title">What would you like to work on?</h2>
                        <p class="selection-subtitle">Choose a format to start your session.</p>
                        <div class="selection-buttons">
                            <button class="btn selection-btn" data-format="lessons">Lessons</button>
                            <button class="btn selection-btn" data-format="videos">Videos</button>
                            <button class="btn selection-btn" data-format="games">Games</button>
                        </div>
                    </div>
                </div>

                <!-- Main learning panel (hidden until a format is chosen) -->
                <div class="learning-panel" id="learningPanel">
                    <!-- Stylised dropdown in top-right of gradient box -->
                    <div class="lesson-format-dropdown" id="lessonFormatDropdown">
                        <button type="button" class="dropdown-toggle" id="lessonFormatToggle">
                            Lesson format: <span id="lessonFormatLabel">Lessons</span>
                            <span class="caret">▾</span>
                        </button>
                        <ul class="dropdown-menu-custom" id="lessonFormatMenu">
                            <li data-format="lessons">Lessons</li>
                            <li data-format="videos">Videos</li>
                            <li data-format="games">Games</li>
                        </ul>
                    </div>

                    <!-- Big gradient placeholder area -->
                    <div class="learning-placeholder" id="learningPlaceholder">
                        <!-- LESSONS LAYOUT -->
                        <div class="lesson-layout" id="lessonLayout">
                            <!-- Left: explanation area (scrollable) -->
                            <section class="lesson-explainer" aria-label="Lesson explanation">
                                <h3 class="lesson-explainer-title">Lesson explanation area</h3>
                                <p class="text-muted mb-3">
                                    This is a placeholder area for your lesson content. You can replace these blocks
                                    with your own images, diagrams, paragraphs, or embedded media.
                                </p>

                                <div class="lesson-content-block placeholder-block">
                                    <h4>Concept overview</h4>
                                    <p>[Insert image and text explaining the main concept here]</p>
                                </div>

                                <div class="lesson-content-block placeholder-block">
                                    <h4>Worked example</h4>
                                    <p>[Insert a worked example with steps and visual aids]</p>
                                </div>

                                <div class="lesson-content-block placeholder-block">
                                    <h4>Key takeaways</h4>
                                    <ul>
                                        <li>[Key idea #1 placeholder]</li>
                                        <li>[Key idea #2 placeholder]</li>
                                        <li>[Key idea #3 placeholder]</li>
                                    </ul>
                                </div>
                            </section>

                            <!-- Right: question area -->
                            <section class="lesson-question" aria-label="Lesson question">
                                <h3 class="question-title" id="lessonQuestionText">
                                    [Question goes here as bold placeholder text]
                                </h3>

                                <div class="answers-grid">
                                    <button class="answer-option" id="answer-1" data-correct="false">
                                        Answer option A
                                    </button>
                                    <button class="answer-option" id="answer-2" data-correct="true">
                                        Answer option B (correct)
                                    </button>
                                    <button class="answer-option" id="answer-3" data-correct="false">
                                        Answer option C
                                    </button>
                                    <button class="answer-option" id="answer-4" data-correct="false">
                                        Answer option D
                                    </button>
                                </div>
                            </section>
                        </div>

                        <!-- VIDEOS LAYOUT -->
                        <div class="videos-layout" id="videosLayout">
                            <div class="videos-main">
                                <button class="video-main-card" id="recommendedVideoBtn">
                                    <div class="video-main-rect">
                                        Civil Engineering: Loads on structures
                                    </div>
                                </button>
                            </div>
                            <div class="videos-sidebar">
                                <div class="video-item">
                                    <div class="video-thumb"></div>
                                    <div class="video-title">[Placeholder similar video title #1]</div>
                                </div>
                                <div class="video-item">
                                    <div class="video-thumb"></div>
                                    <div class="video-title">[Placeholder similar video title #2]</div>
                                </div>
                                <div class="video-item">
                                    <div class="video-thumb"></div>
                                    <div class="video-title">[Placeholder similar video title #3]</div>
                                </div>
                            </div>
                        </div>

                        <!-- GAMES LAYOUT -->
                        <div class="games-layout" id="gamesLayout">
                            <div class="games-main">
                                <button class="game-main-card" id="mainGameBtn">
                                    <div class="game-main-rect">
                                        <div class="game-play-icon"></div>
                                        <div class="game-main-title">Build Your Own Bridge</div>
                                    </div>
                                </button>
                            </div>
                            <div class="games-sidebar">
                                <div class="game-item">
                                    <div class="game-thumb"></div>
                                    <div class="game-title">[Placeholder similar game title #1]</div>
                                </div>
                                <div class="game-item">
                                    <div class="game-thumb"></div>
                                    <div class="game-title">[Placeholder similar game title #2]</div>
                                </div>
                                <div class="game-item">
                                    <div class="game-thumb"></div>
                                    <div class="game-title">[Placeholder similar game title #3]</div>
                                </div>
                            </div>
                        </div>

                        <!-- SIMPLE PLACEHOLDER (not used for core formats now) -->
                        <div class="simple-placeholder" id="simplePlaceholder">
                            <span class="placeholder-text" id="simplePlaceholderText">lessons</span>
                        </div>
                    </div>
                </div>

                <!-- Completion popup for Lessons -->
                <div class="lesson-complete-modal" id="lessonCompleteModal">
                    <div class="lesson-complete-card">
                        <h2>Nice work!</h2>
                        <p>
                            Congratulations, you have demonstrated adequate knowledge of the material
                            discussed in this lesson.
                        </p>
                        <button class="btn btn-solid" id="backToDashboardBtn">
                            Back to dashboard
                        </button>
                    </div>
                </div>

                <!-- Video viewer popup -->
                <div class="video-viewer-modal" id="videoViewerModal">
                    <div class="video-viewer-card">
                        <div class="ratio ratio-16x9">
                            <iframe
                                id="videoIframe"
                                src="https://www.youtube.com/embed/e6NVVuCZu-Q"
                                title="Civil Engineering: Loads on structures"
                                frameborder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                allowfullscreen
                            ></iframe>
                        </div>
                        <div class="video-viewer-actions">
                            <button class="btn btn-outline-secondary" id="exitViewingBtn">
                                Exit viewing
                            </button>
                            <button class="btn btn-solid" id="videoBackToDashboardBtn">
                                Back to dashboard
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // personalisation / query params
            const params = new URLSearchParams(window.location.search);
            const name = params.get('name');
            const interestsParam = params.get('interests');
            const parentName = params.get('parentName') || '';
            const parentEmail = params.get('parentEmail') || '';
            const studentId = params.get('studentId') || '';

            const subjectSelect = document.getElementById('subjectSelect');
            if (subjectSelect) {
                if (interestsParam && ['Engineering', 'Physics', 'Maths'].includes(interestsParam)) {
                    subjectSelect.value = interestsParam;
                } else {
                    subjectSelect.value = 'Engineering';
                }
            }

            const settingsButton = document.getElementById('settingsButton');
            if (settingsButton) {
                settingsButton.addEventListener('click', () => {
                    const subject = subjectSelect ? subjectSelect.value : (interestsParam || '');
                    const url =
                        `user-settings.html?studentId=${encodeURIComponent(studentId)}` +
                        `&name=${encodeURIComponent(name || '')}` +
                        `&interests=${encodeURIComponent(subject || '')}` +
                        `&parentName=${encodeURIComponent(parentName)}` +
                        `&parentEmail=${encodeURIComponent(parentEmail)}`;
                    window.location.href = url;
                });
            }

            const learningSelection = document.getElementById('learningSelection');
            const learningPanel = document.getElementById('learningPanel');
            const lessonLayout = document.getElementById('lessonLayout');
            const videosLayout = document.getElementById('videosLayout');
            const gamesLayout = document.getElementById('gamesLayout');
            const simplePlaceholder = document.getElementById('simplePlaceholder');
            const simplePlaceholderText = document.getElementById('simplePlaceholderText');

            const dropdown = document.getElementById('lessonFormatDropdown');
            const menu = document.getElementById('lessonFormatMenu');
            const toggleBtn = document.getElementById('lessonFormatToggle');
            const formatLabel = document.getElementById('lessonFormatLabel');

            const selectionButtons = document.querySelectorAll('.selection-btn');
            const answerOptions = document.querySelectorAll('.answer-option');
            const lessonCompleteModal = document.getElementById('lessonCompleteModal');
            const backToDashboardBtn = document.getElementById('backToDashboardBtn');

            const videoHeaderRow = document.getElementById('videoHeaderRow');

            const recommendedVideoBtn = document.getElementById('recommendedVideoBtn');
            const videoViewerModal = document.getElementById('videoViewerModal');
            const exitViewingBtn = document.getElementById('exitViewingBtn');
            const videoBackToDashboardBtn = document.getElementById('videoBackToDashboardBtn');
            const videoIframe = document.getElementById('videoIframe');

            // initial state
            if (learningSelection) learningSelection.style.display = 'flex';
            if (learningPanel) learningPanel.style.display = 'none';

            function setActiveFormat(format) {
                if (!simplePlaceholder || !simplePlaceholderText || !formatLabel) return;

                if (format === 'lessons') {
                    if (lessonLayout) lessonLayout.style.display = 'flex';
                    if (videosLayout) videosLayout.style.display = 'none';
                    if (gamesLayout) gamesLayout.style.display = 'none';
                    simplePlaceholder.style.display = 'none';
                } else if (format === 'videos') {
                    if (lessonLayout) lessonLayout.style.display = 'none';
                    if (videosLayout) videosLayout.style.display = 'flex';
                    if (gamesLayout) gamesLayout.style.display = 'none';
                    simplePlaceholder.style.display = 'none';
                } else if (format === 'games') {
                    if (lessonLayout) lessonLayout.style.display = 'none';
                    if (videosLayout) videosLayout.style.display = 'none';
                    if (gamesLayout) gamesLayout.style.display = 'flex';
                    simplePlaceholder.style.display = 'none';
                } else {
                    if (lessonLayout) lessonLayout.style.display = 'none';
                    if (videosLayout) videosLayout.style.display = 'none';
                    if (gamesLayout) gamesLayout.style.display = 'none';
                    simplePlaceholder.style.display = 'flex';
                    simplePlaceholderText.textContent = format;
                }

                formatLabel.textContent = format.charAt(0).toUpperCase() + format.slice(1);

                if (videoHeaderRow) {
                    videoHeaderRow.style.display = (format === 'videos') ? 'flex' : 'none';
                }
            }

            function showPanelFor(format) {
                if (learningSelection) learningSelection.style.display = 'none';
                if (learningPanel) learningPanel.style.display = 'block';
                setActiveFormat(format);
            }

            selectionButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const format = btn.getAttribute('data-format') || 'lessons';
                    showPanelFor(format);
                });
            });

            if (toggleBtn && dropdown && menu) {
                toggleBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    dropdown.classList.toggle('open');
                });

                menu.addEventListener('click', (e) => {
                    const item = e.target.closest('li[data-format]');
                    if (!item) return;
                    const format = item.getAttribute('data-format');
                    if (!format) return;
                    setActiveFormat(format);
                    dropdown.classList.remove('open');
                });

                document.addEventListener('click', (e) => {
                    if (!dropdown.contains(e.target)) {
                        dropdown.classList.remove('open');
                    }
                });
            }

            answerOptions.forEach(btn => {
                btn.addEventListener('click', () => {
                    const isCorrect = btn.dataset.correct === 'true';
                    const flashClass = isCorrect ? 'flash-correct' : 'flash-incorrect';

                    btn.classList.remove('flash-correct', 'flash-incorrect');
                    void btn.offsetWidth;
                    btn.classList.add(flashClass);

                    setTimeout(() => {
                        btn.classList.remove(flashClass);
                    }, 350);

                    if (isCorrect && lessonCompleteModal) {
                        lessonCompleteModal.classList.add('active');
                    }
                });
            });

            if (backToDashboardBtn && lessonCompleteModal) {
                backToDashboardBtn.addEventListener('click', () => {
                    lessonCompleteModal.classList.remove('active');

                    if (learningPanel) learningPanel.style.display = 'none';
                    if (learningSelection) learningSelection.style.display = 'flex';

                    setActiveFormat('lessons');
                });
            }

            function closeVideoModal() {
                if (videoViewerModal) videoViewerModal.classList.remove('active');
                if (videoIframe) {
                    const src = videoIframe.getAttribute('src');
                    videoIframe.setAttribute('src', src);
                }
            }

            if (recommendedVideoBtn && videoViewerModal) {
                recommendedVideoBtn.addEventListener('click', () => {
                    videoViewerModal.classList.add('active');
                });
            }

            if (exitViewingBtn) {
                exitViewingBtn.addEventListener('click', () => {
                    closeVideoModal();
                });
            }

            if (videoBackToDashboardBtn) {
                videoBackToDashboardBtn.addEventListener('click', () => {
                    closeVideoModal();

                    if (learningPanel) learningPanel.style.display = 'none';
                    if (learningSelection) learningSelection.style.display = 'flex';

                    setActiveFormat('lessons');
                });
            }

            const mainGameBtn = document.getElementById('mainGameBtn');
            if (mainGameBtn) {
                mainGameBtn.addEventListener('click', () => {
                    // future game logic goes here
                });
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
